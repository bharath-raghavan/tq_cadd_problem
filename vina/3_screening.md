# Virtual Screening

With the receptor generated and parameters for docking set, we can now move on to structure-based virtual screening of the 250 selected compounds. This step cannot be run in a Jupyter notebook, and so I give the details as a Markdown file.

## Ligand Preparation

We need to convert the SMILES strings in the ligand database to 3D conformers. This can be done with the `molscrub` package, which uses RDKit as a backend but also accounts for protonation at the right pH (which RDKit does not). The conformers generated by `molscrub` are then converted to the format Autodock Vina expects using `mk_prepare_ligand.py`. Run the following command:

```
scrub.py ../../db/filtered.smi -o ligands.sdf --ph_low 7.4 --ph_high 7.4 --ff mmff94
mk_prepare_ligand.py -i ligands.sdf --multimol_outdir ligprep/
```

## Docking

With the ligands prepared, batched docking in Autodock Vina is run:

```
vina --batch ligprep/*.pdbqt --receptor 1ppb_receptor.pdbqt \
    --config 1ppb_receptor.box.txt --exhaustiveness=8 --dir ./ \
    --num_modes 9 | tee out.log
```

The compounds are then ranked on their docking scores and the top 10 are extracted.
